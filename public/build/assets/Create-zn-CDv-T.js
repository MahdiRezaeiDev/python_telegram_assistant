import{r as c,j as e,H as C,b as v}from"./app-BqfSY66W.js";import{A as k}from"./AuthenticatedLayout-BD6RdAD5.js";import{T as S,t as x}from"./index-BiFnSlCp.js";import{S as L}from"./search-BuYp6s9R.js";import{c as _}from"./createLucideIcon-Hng2jIgv.js";import{L as z}from"./loader-circle-DQ-HXIqi.js";import{S as f}from"./save-BnrkiLM3.js";import"./transition-CYzJCn0g.js";import"./index-CjicLJss.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],F=_("circle-plus",E);function O({sellers:l=[]}){const[a,n]=c.useState([]),[d,m]=c.useState(l.reduce((t,s)=>({...t,[s.id]:{}}),{})),[i,p]=c.useState(!1),[h,y]=c.useState(""),b=()=>{n(t=>[...t,{id:t.length+1,code:""}])},j=(t,s)=>{const r=[...a];r[t].code=s.toUpperCase(),n(r)},N=(t,s,r)=>{r=r.toUpperCase(),m(o=>({...o,[t]:{...o[t],[s]:r}}))},u=async()=>{try{p(!0);const t=l.map(s=>({seller_id:s.id,codes:a.filter(r=>r.code?.trim()&&d[s.id]?.[r.id]!==void 0&&d[s.id][r.id]!=="").map(r=>({code:r.code,price:d[s.id][r.id]}))})).filter(s=>s.codes.length>0);if(t.length===0){x.error("لطفا حداقل یک کد و قیمت معتبر وارد نمایید.",{position:"bottom-left",style:{backgroundColor:"orange",fontFamily:"Vazir",color:"white",fontWeight:"bold"}});return}await v.post(route("prices.store"),{data:t}),x.success("عملیات موفقانه انجام شد.",{description:"قیمت های گرفته شما موفقانه ثبت سیستم گردید.",position:"bottom-left",style:{backgroundColor:"seagreen",fontFamily:"Vazir",color:"white",fontWeight:"bold"}}),n([]),m(l.reduce((s,r)=>({...s,[r.id]:{}}),{}))}catch(t){console.error(t),x.error("خطا در انجام عملیات",{description:"عملیات ثبت قیمت های بازار ناموفق بود، لطفا بعدا تلاش نمایید.",position:"bottom-left",style:{backgroundColor:"red",fontFamily:"Vazir",color:"white",fontWeight:"bold"}})}finally{p(!1)}},w=t=>{n(s=>s.filter(r=>r.id!==t)),m(s=>{const r={...s};return Object.keys(r).forEach(o=>{delete r[o][t]}),r})},g=l.filter(t=>t.full_name.toLowerCase().includes(h.toLowerCase()));return e.jsxs(k,{title:"ثبت قیمت های بازار",children:[e.jsx(C,{title:"قیمت‌ها"}),e.jsx(S,{richColors:!0}),e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"mx-auto w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-800",children:"ثبت قیمت های بازار"}),e.jsxs("div",{className:"relative flex items-center gap-2",children:[e.jsx(L,{className:"absolute left-2 h-5 w-5 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"جستجوی فروشنده...",value:h,onChange:t=>y(t.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm text-gray-700 placeholder-gray-400 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-300 md:w-64"})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-full border-collapse text-sm",children:[e.jsx("thead",{className:"bg-gray-100 text-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"sticky top-0 w-52 border-b px-4 py-2 text-right font-semibold",children:"فروشنده"}),a.map((t,s)=>e.jsx("th",{className:"px-2 py-2 text-right",children:e.jsxs("div",{className:"relative flex gap-1",children:[e.jsx("input",{type:"text",placeholder:"کد فنی",value:t.code,onChange:r=>j(s,r.target.value),style:{direction:"ltr"},className:"w-32 rounded border border-gray-300 p-2 text-sm text-gray-700 placeholder-gray-400 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-300"}),e.jsx("button",{type:"button",onClick:()=>w(t.id),className:"absolute right-2 top-[6px] text-xl text-red-600 hover:text-red-800",title:"حذف کد",children:"×"})]})},t.id)),e.jsx("th",{className:"border-b px-2 py-2 text-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:b,title:"افزودن کد جدید",className:"rounded-full p-1 text-gray-600 transition hover:bg-gray-200",children:e.jsx(F,{className:"h-5 w-5"})}),e.jsx("span",{onClick:u,disabled:i,title:"ثبت کد ها",children:i?e.jsx(z,{className:"h-5 w-5 animate-spin"}):e.jsx(f,{className:"h-5 w-5 cursor-pointer"})})]})})]})}),e.jsxs("tbody",{children:[g.map((t,s)=>e.jsxs("tr",{className:`transition hover:bg-gray-50 ${s%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"border-b px-4 py-2 font-medium text-gray-800",children:t.full_name}),a.map(r=>e.jsx("td",{className:"w-32 border-b px-2 py-2",children:e.jsx("input",{placeholder:"قیمت",value:d[t.id][r.id]||"",onChange:o=>N(t.id,r.id,o.target.value),style:{direction:"ltr"},className:"w-32 rounded border border-gray-300 p-2 text-sm focus:border-green-500 focus:outline-none focus:ring-1 focus:ring-green-300"})},r.id)),e.jsx("td",{className:"border-b px-2 py-2"})]},t.id)),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:a.length+2,className:"py-4 text-center text-gray-500",children:"فروشنده‌ای پیدا نشد."})})]})]})}),e.jsx("div",{className:"flex justify-start",children:e.jsxs("button",{onClick:u,disabled:i,className:`flex items-center gap-2 rounded-md px-4 py-2 font-medium text-white transition ${i?"cursor-not-allowed bg-cyan-400":"bg-cyan-600 hover:bg-cyan-700"}`,children:[e.jsx(f,{className:"h-5 w-5"}),i?"در حال ذخیره...":"ذخیره قیمت‌ها"]})})]})})]})}export{O as default};
