import{r,a as v,j as e,H as k,b as h}from"./app-BqfSY66W.js";import{P as C}from"./PrimaryButton-DglqdRJN.js";import{A as _}from"./AuthenticatedLayout-BD6RdAD5.js";import{T as L,t as l}from"./index-BiFnSlCp.js";import{S}from"./search-BuYp6s9R.js";import{L as c}from"./loader-circle-DQ-HXIqi.js";import"./transition-CYzJCn0g.js";import"./createLucideIcon-Hng2jIgv.js";import"./index-CjicLJss.js";function W({contacts:u}){const[o,d]=r.useState(u||[]),[a,f]=r.useState(""),[i,x]=r.useState(!1),[g,p]=r.useState(null),{auth:j}=v().props,w=j.user.role,b=async()=>{x(!0);try{const t=await h.post(route("contacts.get"));t.data?.data&&(d(t.data.data),l.success("عملیات موفقانه انجام شد.",{description:"اطلاعات مخاطبین به‌روزرسانی شد.",position:"bottom-left",duration:4e3,style:{backgroundColor:"seagreen",fontFamily:"Vazir",color:"white",fontWeight:"bold"}}))}catch(t){console.error(t),l.error("خطا در بارگیری مخاطبین")}finally{x(!1)}},y=async t=>{p(t);try{const s=await h.post(route("contacts.toggleBlock"),{contact_id:t}),N=o.map(n=>n.id===t?{...n,is_blocked:s.data.blocked}:n);d(N),l.success("وضعیت کاربر تغییر کرد.",{description:s.data.blocked?"کاربر بلاک شد.":"کاربر از بلاک خارج شد.",position:"bottom-left",duration:4e3,style:{backgroundColor:"seagreen",fontFamily:"Vazir",color:"white",fontWeight:"bold"}})}catch(s){console.error("Error toggling block:",s),l.error("خطا در تغییر وضعیت کاربر")}finally{p(null)}},m=r.useMemo(()=>o.filter(t=>(t.full_name||"").toLowerCase().includes(a.toLowerCase())||(t.username||"").toLowerCase().includes(a.toLowerCase())||(t.phone||"").includes(a)),[o,a]);return e.jsxs(_,{title:"لیست مخاطبین",children:[e.jsx(k,{title:"لیست مخاطبین"}),e.jsx(L,{richColors:!0}),e.jsx("div",{className:"flex flex-wrap pt-8",children:e.jsx("div",{className:"mb-12 w-full px-4",children:e.jsxs("div",{className:"relative flex w-full min-w-0 flex-col overflow-auto break-words rounded bg-white pb-8 shadow-lg",children:[e.jsxs("div",{className:"mb-0 flex items-center justify-between rounded-t border-b bg-gray-50 px-4 py-3",children:[e.jsx("h3",{className:"text-blueGray-700 text-lg font-semibold",children:"لیست پرسنل ثبت شده"}),e.jsxs("div",{className:"relative w-96",children:[e.jsx("input",{type:"text",placeholder:"جستجو بر اساس نام، شماره یا نام کاربری...",value:a,onChange:t=>f(t.target.value),className:"w-full rounded border px-4 py-2 text-xs shadow-sm focus:outline-none focus:ring focus:ring-cyan-400"}),e.jsx(S,{className:"absolute left-2 top-2 h-4 w-4 text-gray-400"})]}),w==="admin"&&e.jsx(C,{onClick:b,disabled:i,className:"flex items-center gap-2 rounded bg-cyan-700 px-4 py-2 text-xs font-bold text-white hover:shadow-md disabled:opacity-60",children:i?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"h-4 w-4 animate-spin"}),"در حال بارگیری..."]}):"بارگیری مخاطبین"})]}),e.jsx("div",{className:"relative w-full overflow-x-auto overflow-y-visible rounded-b",children:i?e.jsxs("div",{className:"flex items-center justify-center py-10",children:[e.jsx(c,{className:"h-8 w-8 animate-spin text-cyan-700"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"در حال بارگیری داده‌ها..."})]}):e.jsxs("table",{className:"min-w-full border-collapse bg-transparent text-right",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-cyan-700 text-white",children:[e.jsx("th",{className:"px-6 py-3 text-right text-sm",children:"#"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm",children:"نام و نام خانوادگی"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm",children:"شماره تماس"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm",children:"نام کاربری"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm",children:"پروفایل"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm",children:"شناسه یکتا"}),e.jsx("th",{className:"px-6 py-3 text-center text-sm",children:"بلاک"})]})}),e.jsx("tbody",{children:m.length?m.map((t,s)=>e.jsxs("tr",{className:`odd:bg-gray-50 ${t.is_blocked?"bg-red-50":""}`,children:[e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-sm",children:s+1}),e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-sm",children:t.full_name}),e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-sm",children:t.phone||"-"}),e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-sm",children:t.username||"-"}),e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-sm",children:t.profile_photo_path?e.jsx("img",{src:"http://127.0.0.1:5000/"+t.profile_photo_path,alt:t.full_name,className:"h-10 w-10 rounded-full border object-cover"}):e.jsx("span",{className:"text-gray-400",children:"بدون عکس"})}),e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-sm",children:t.api_bot_id||"-"}),e.jsx("td",{className:"whitespace-nowrap p-4 px-6 text-center text-sm",children:g===t.id?e.jsx(c,{className:"mx-auto h-5 w-5 animate-spin text-cyan-700"}):e.jsx("input",{type:"checkbox",checked:t.is_blocked,onChange:()=>y(t.id),className:"h-5 w-5 cursor-pointer accent-red-600"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"p-4 text-center text-sm",children:"هیچ مخاطبی پیدا نشد."})})})]})})]})})})]})}export{W as default};
